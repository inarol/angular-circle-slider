angular.module("ui.circleSlider",[]).directive("circleSlider",["$document","$timeout",function(e,n){return{restrict:"A",replace:!0,scope:{value:"=",max:"@",readonly:"@",onSliderStart:"=",onSliderChange:"=",onSliderEnd:"="},template:'<div class="circle" tabIndex="0">   <div class="text-wrap"><span class="text"></span></div>   <div class="handler"></div></div>',link:function(a,t,i){function d(e){var n=Math.round(m*Math.sin(e*w)),t=Math.round(m*-Math.cos(e*w)),i=e*a.max/360|0;S.css({left:n+m-x,top:t+m-x}),h.html(i+"&deg;")}function l(e){var t={x:e.pageX-b.x,y:e.pageY-b.y},i=Math.atan2(t.x-m,t.y-m),l=parseInt(-i/w+180);return n(function(){d(l),a.value=l||a.value},30),l||a.value}function o(){f&&a.onSliderEnd(a.value),e.unbind("mousemove",l),e.unbind("mouseup",o)}function u(e){switch(s&&a.onSliderStart(a.value),e.keyCode){case 40:case 39:a.$apply(function(){a.value=a.value++<a.max?a.value:0});break;case 38:case 37:a.$apply(function(){a.value=a.value--<0?a.max:a.value})}}function r(){f&&a.onSliderEnd(a.value)}var c=i.readonly,s=i.onSliderStart,v=i.onSliderChange,f=i.onSliderEnd,p=t,S=p.find(".handler"),h=p.find(".text"),m=p.width()/2,x=S.width()/2,y=p.offset(),b={x:y.left,y:y.top},w=Math.PI/180;a.$watch("value",function(e,n){d(a.value),e!==n&&v&&a.onSliderChange(e)}),p.bind("mousedown",function(n){if(!c){var t=l(n);s&&a.onSliderStart(t),e.bind("mousemove",l),e.bind("mouseup",o)}}),p.bind("keydown",u),p.bind("keydown",r)}}}]);