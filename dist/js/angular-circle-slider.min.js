angular.module("ui.circleSlider",[]).directive("circleSlider",["$document","$timeout",function(e,n){return{restrict:"EA",replace:!0,scope:{value:"=",max:"@",readonly:"@",onSliderStart:"=",onSliderChange:"=",onSliderEnd:"="},template:'<div class="circle" tabIndex="0">   <div class="text-wrap"><span class="text"></span></div>   <div class="handler"></div></div>',link:function(a,t,i){function l(e){var n=Math.round(x*Math.sin(e*y)),t=Math.round(x*-Math.cos(e*y)),i=e*a.max/360|0;h.css({left:n+x-b,top:t+x-b}),m.html(i+"&deg;")}function d(e){var t=S.offset(),i={x:e.pageX-t.left,y:e.pageY-t.top},d=Math.atan2(i.x-x,i.y-x),u=parseInt(-d/y+180);return l(u),c=n(function(){a.value=u||a.value,n.cancel(c)},30),u||a.value}function u(){p&&a.onSliderEnd(a.value),e.unbind("mousemove",d),e.unbind("mouseup",u)}function o(e){switch(v&&a.onSliderStart(a.value),e.keyCode){case 40:case 39:a.$apply(function(){a.value=a.value++<a.max?a.value:0});break;case 38:case 37:a.$apply(function(){a.value=a.value--<0?a.max:a.value})}}function r(){p&&a.onSliderEnd(a.value)}var c,s=i.readonly,v=i.onSliderStart,f=i.onSliderChange,p=i.onSliderEnd,S=t,h=S.find(".handler"),m=S.find(".text"),x=S.width()/2,b=h.width()/2,y=Math.PI/180;a.$watch("value",function(e,n){l(a.value),e!==n&&f&&a.onSliderChange(e)}),S.bind("mousedown",function(n){if(!s){var t=d(n);v&&a.onSliderStart(t),e.bind("mousemove",d),e.bind("mouseup",u)}}),S.bind("keydown",o),S.bind("keyup",r)}}}]);